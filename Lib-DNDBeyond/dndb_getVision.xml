<net.rptools.maptool.model.MacroButtonProperties>
  <macroUUID>24fe116a-4366-4b78-94ae-7f5b7b43fd19</macroUUID>
  <saveLocation>Token</saveLocation>
  <index>43</index>
  <colorKey>default</colorKey>
  <hotKey>None</hotKey>
  <command>[h: toon = arg(0)]

[h, if (json.length (macro.args) &gt; 1): allVisions = arg(1); allVisions = json.append ("", "Blindsight", "Darkvision", "Tremorsense", "Truesight")]
[h: visions = "[]"]

[h, foreach (vision, allVisions), code: {
	[h: distance = 0]
	[h: lowerVision = lower (vision)]
	[h: distances = dndb_searchGrantedModifiers (json.set ("", 
										"object", toon,
										"property", "value",
										"subType", lowerVision,
										"type", "set-base"))]
	[h: log.debug ("dndb_getVision: distances = " + distances]
	[h, if (json.length (distances) &gt; 0), code: {
		[h: distance = json.get (json.sort (distances), 0)]
	}]

	[h: bonuses = dndb_searchGrantedModifiers (json.set ("", 
										"object", toon,
										"property", "value",
										"subType", lowerVision,
										"type", "sense"))]
	[h, foreach (bonus, bonuses): distance = distance + bonus]
	
	[h, if (distance &gt; 0): visions = json.append (visions, json.set ("", 
										"name", vision, 
										"distance", distance))]
}]

[h: macro.return = visions]</command>
  <label>dndb_getVision</label>
  <group>Character</group>
  <sortby/>
  <autoExecute>true</autoExecute>
  <includeLabel>false</includeLabel>
  <applyToTokens>false</applyToTokens>
  <fontColorKey>black</fontColorKey>
  <fontSize>1.00em</fontSize>
  <minWidth/>
  <maxWidth/>
  <allowPlayerEdits>false</allowPlayerEdits>
  <toolTip>Returns the vision of the passed in character. An empty result indicates "normal" vision.

arg (0) = toon

return ex.
[
	{
		"name" : "Darkvision",
		"distance" : "60"
	},
	{
		"name" : "Blindsight",
		"distance" : "10"
	}
]</toolTip>
  <displayHotKey>true</displayHotKey>
  <commonMacro>false</commonMacro>
  <compareGroup>true</compareGroup>
  <compareSortPrefix>true</compareSortPrefix>
  <compareCommand>true</compareCommand>
  <compareIncludeLabel>true</compareIncludeLabel>
  <compareAutoExecute>true</compareAutoExecute>
  <compareApplyToSelectedTokens>true</compareApplyToSelectedTokens>
</net.rptools.maptool.model.MacroButtonProperties>
